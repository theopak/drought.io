"use strict";var app=angular.module("droughtioApp",["ngAnimate","ngResource","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]);app.factory("globalService",function(){var a=[],b=[],c=[],d=function(a){angular.forEach(c,function(b){b.kind===a&&b.callback()})},e={registerObserverCallback:function(a,b){c.push({kind:a,callback:b})},deselect:function(a){b.push(a),d("deselect")},nextDeselection:function(){return b.shift()},select:function(b){a.push(b),d("select")},nextSelection:function(){return a.shift()}};return e});var reformatNormalsResponse=function(a){console.log(a);var b=[],c=0;return angular.forEach(a,function(a,d){console.log("data point:",d,a),b.push({x:Date.parse(a.date),y:c+=a.value})}),console.log(b),b};app.factory("RainfallSeriesProvider",["$resource",function(a){return a("../assets/prcp/:year-fips:id.json",{},{get:{method:"GET",isArray:!0,transformResponse:function(a){var b=0,c=0,d=angular.fromJson(a).results;return _.map(d,function(a){if(0===c)a.date=c;else{if(c==a.date)return void console.log("skip "+a.date);c=a.date}return b+=a.value})}}})}]),app.factory("d3Service",["$document","$window","$q","$rootScope",function(a,b,c,d){function e(){d.$apply(function(){f.resolve(b.d3)})}var f=c.defer(),g={d3:function(){return f.promise}},h=a[0].createElement("script");h.type="text/javascript",h.async=!0,h.src="http://d3js.org/d3.v3.min.js",h.onreadystatechange=function(){"complete"===this.readyState&&e()},h.onload=e;var i=a[0].getElementsByTagName("body")[0];return i.appendChild(h),g}]),app.directive("droughtMap",["d3Service","$q","globalService",function(a,b,c){return{restrict:"AE",replace:!1,scope:{data:"=",onClick:"&"},link:function(b,d){console.log("inside drought map!!!"),a.d3().then(function(a){var b={1:{name:"Alabama",percentIrrigated:1.2},2:{name:"Alaska",percentIrrigated:1.6},4:{name:"Arizona",percentIrrigated:12.9},5:{name:"Arkansas",percentIrrigated:25.2},6:{name:"California",percentIrrigated:25.2},8:{name:"Colorado",percentIrrigated:11.2},9:{name:"Connecticut",percentIrrigated:2.3},10:{name:"Delaware",percentIrrigated:19.7},12:{name:"Florida",percentIrrigated:11},11:{name:"DC",percentIrrigated:0},13:{name:"Georgia",percentIrrigated:7.4},15:{name:"Hawaii",percentIrrigated:12.6},16:{name:"Idaho",percentIrrigated:29.7},17:{name:"Illinois",percentIrrigated:2},18:{name:"Indiana",percentIrrigated:2.9},19:{name:"Iowa",percentIrrigated:.6},20:{name:"Kansas",percentIrrigated:5.9},21:{name:"Kentucky",percentIrrigated:.4},22:{name:"Louisiana",percentIrrigated:8.8},23:{name:"Maine",percentIrrigated:1.4},24:{name:"Maryland",percentIrrigated:3.8},25:{name:"Massachusetts",percentIrrigated:6.1},26:{name:"Michigan",percentIrrigated:4.6},27:{name:"Minnesota",percentIrrigated:2.8},28:{name:"Mississippi",percentIrrigated:8.3},29:{name:"Missouri",percentIrrigated:4.2},30:{name:"Montana",percentIrrigated:4.8},31:{name:"Nebraska",percentIrrigated:22.3},32:{name:"Nevada",percentIrrigated:20.1},33:{name:"New Hampshire",percentIrrigated:.6},34:{name:"New Jersey",percentIrrigated:14.1},35:{name:"New Mexico",percentIrrigated:2.1},36:{name:"New York",percentIrrigated:1.6},37:{name:"North Carolina",percentIrrigated:2},38:{name:"North Dakota",percentIrrigated:.7},39:{name:"Ohio",percentIrrigated:.5},40:{name:"Oklahoma",percentIrrigated:1.1},41:{name:"Oregon",percentIrrigated:12.5},42:{name:"Pennsylvania",percentIrrigated:.6},44:{name:"Rhode Island",percentIrrigated:6.9},45:{name:"South Carolina",percentIrrigated:3.1},46:{name:"South Dakota",percentIrrigated:1.4},47:{name:"Tennessee",percentIrrigated:1.2},48:{name:"Texas",percentIrrigated:3.4},49:{name:"Utah",percentIrrigated:16.9},50:{name:"Vermont",percentIrrigated:.3},51:{name:"Virginia",percentIrrigated:.9},53:{name:"Washington",percentIrrigated:10.4},54:{name:"West Virginia",percentIrrigated:.1},55:{name:"Wisconsin",percentIrrigated:3.3},56:{name:"Wyoming",percentIrrigated:8.7},72:{name:"Puerto Rico",percentIrrigated:0},78:{name:"Virgin Islands",percentIrrigated:0}};for(var e in b)b[e].percentIrrigated=b[e].percentIrrigated<1?"percentIrrigated1":b[e].percentIrrigated<5?"percentIrrigated5":b[e].percentIrrigated<15?"percentIrrigated15":b[e].percentIrrigated<25?"percentIrrigated25":"percentIrrigatedMax";var f=$(d[0]).innerWidth(),g=Math.max(window.innerHeight-30-$("#navbar").outerHeight(),240),h=320,i=Math.max((g-h)/2,0);$("#map").parent().find("h2").css("margin-top",i);var j=a.geo.albersUsa().scale(1.3*f).translate([f/2,h/2]),k=a.geo.path().projection(j),l=a.select(d[0]).append("svg").attr("width",f).attr("height",h),m=l.append("g"),n=[];a.json("/assets/us.json",function(d,e){m.append("g").attr("id","states").selectAll("path").data(topojson.feature(e,e.objects.states).features).enter().append("path").attr("class","administrative").attr("d",k).on("click",function(b){var d=b.id,e=b.id.toString().length>=2?b.id.toString():new Array(2-b.id.toString().length+1).join("0")+b.id.toString()+"";a.select(this).attr("id","fips"+e),n&&n[d]===!0?(n[d]=!1,a.select(this).attr("class","administrative")):(n[d]=!0,c.select(d),a.select(this).attr("class","administrative-selected")),console.log(d)}),m.append("g").attr("id","irrigation").attr("visibility","hidden").selectAll("path").data(topojson.feature(e,e.objects.states).features).enter().append("path").attr("class",function(a){var c=b[a.id].percentIrrigated;return console.log("!!!!!",c),c.toString()}).attr("d",k).on("click",function(d){var e=d.id,f=b[d.id].percentIrrigated;a.select(this).attr("id",b[d.id].name),n&&n[e]===!0?(n[e]=!1,c.deselect(e),a.select(this).attr("class",f)):(n[e]=!0,c.select(e),f+="-selected",a.select(this).attr("class",f)),console.log(e)})}),a.json("/assets/USDM_20141111-topo.json",function(a,b){var c={};for(var d in b.objects)if(c=b.objects[d],"function"!=typeof c)break;var e=0;m.append("g").attr("id","zones").selectAll("path").data(topojson.feature(b,c).features).enter().append("path").attr("class","zone").attr("d",k).attr("class",function(){return"severity"+e++})})})}}}]),app.directive("d3Bars",["$window","$timeout","d3Service",function(a,b,c){return{restrict:"A",scope:{data:"=",label:"@",onClick:"&"},link:function(d,e,f){console.log("!!!"),c.d3().then(function(c){var g,h=parseInt(f.margin)||20,i=parseInt(f.barHeight)||20,j=parseInt(f.barPadding)||5,k=c.select(e[0]).append("svg").style("width","100%");a.onresize=function(){d.$apply()},d.$watch(function(){return angular.element(a)[0].innerWidth},function(){d.render(d.data)}),d.$watch("data",function(a){d.render(a)},!0),d.render=function(a){k.selectAll("*").remove(),a&&(g&&clearTimeout(g),g=b(function(){var b=c.select(e[0])[0][0].offsetWidth-h,f=d.data.length*(i+j),g=c.scale.category20(),l=c.scale.linear().domain([0,c.max(a,function(a){return a.score})]).range([0,b]);k.attr("height",f),k.selectAll("rect").data(a).enter().append("rect").on("click",function(a){return d.onClick({item:a})}).attr("height",i).attr("width",140).attr("x",Math.round(h/2)).attr("y",function(a,b){return b*(i+j)}).attr("fill",function(a){return g(a.score)}).transition().duration(1e3).attr("width",function(a){return l(a.score)}),k.selectAll("text").data(a).enter().append("text").attr("fill","#fff").attr("y",function(a,b){return b*(i+j)+15}).attr("x",15).text(function(a){return a.name+" (scored: "+a.score+")"})},200))}})}}}]),app.controller("MainCtrl",["$scope","$http","globalService","RainfallSeriesProvider",function(a,b,c,d){function e(a,b,c){return c=c||"0",a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a}a.selectionQueue=[],a.year=2013,a.rainfallSeriesCollection=[];var f={name:"Troy, NY",color:"orange",data:[{x:a.year.toString()+"-01-01",y:0},{x:a.year.toString()+"-01-02",y:0},{x:a.year.toString()+"-01-03",y:0},{x:a.year.toString()+"-01-04",y:0},{x:a.year.toString()+"-01-05",y:0},{x:a.year.toString()+"-01-06",y:0},{x:a.year.toString()+"-01-07",y:0},{x:a.year.toString()+"-01-08",y:0},{x:a.year.toString()+"-01-09",y:0},{x:a.year.toString()+"-01-10",y:0},{x:a.year.toString()+"-01-11",y:0},{x:a.year.toString()+"-01-12",y:0},{x:a.year.toString()+"-01-13",y:0},{x:a.year.toString()+"-01-14",y:0},{x:a.year.toString()+"-01-15",y:0},{x:a.year.toString()+"-01-16",y:0},{x:a.year.toString()+"-01-17",y:0},{x:a.year.toString()+"-01-18",y:0},{x:a.year.toString()+"-01-19",y:0},{x:a.year.toString()+"-01-20",y:0},{x:a.year.toString()+"-01-21",y:0},{x:a.year.toString()+"-01-22",y:0},{x:a.year.toString()+"-01-23",y:0},{x:a.year.toString()+"-01-24",y:0},{x:a.year.toString()+"-01-25",y:0},{x:a.year.toString()+"-01-26",y:0},{x:a.year.toString()+"-01-27",y:0},{x:a.year.toString()+"-01-28",y:0},{x:a.year.toString()+"-01-29",y:0},{x:a.year.toString()+"-01-30",y:0},{x:a.year.toString()+"-01-31",y:0},{x:a.year.toString()+"-02-01",y:0},{x:a.year.toString()+"-02-02",y:0},{x:a.year.toString()+"-02-03",y:0},{x:a.year.toString()+"-02-04",y:0},{x:a.year.toString()+"-02-05",y:0},{x:a.year.toString()+"-02-06",y:0},{x:a.year.toString()+"-02-07",y:0},{x:a.year.toString()+"-02-08",y:0},{x:a.year.toString()+"-02-09",y:0},{x:a.year.toString()+"-02-10",y:0},{x:a.year.toString()+"-02-11",y:0},{x:a.year.toString()+"-02-12",y:0},{x:a.year.toString()+"-02-13",y:0},{x:a.year.toString()+"-02-14",y:0},{x:a.year.toString()+"-02-15",y:0},{x:a.year.toString()+"-02-16",y:0},{x:a.year.toString()+"-02-17",y:0},{x:a.year.toString()+"-02-18",y:0},{x:a.year.toString()+"-02-19",y:0},{x:a.year.toString()+"-02-20",y:0},{x:a.year.toString()+"-02-21",y:0},{x:a.year.toString()+"-02-22",y:0},{x:a.year.toString()+"-02-23",y:0},{x:a.year.toString()+"-02-24",y:0},{x:a.year.toString()+"-02-25",y:0},{x:a.year.toString()+"-02-26",y:0},{x:a.year.toString()+"-02-27",y:0},{x:a.year.toString()+"-02-28",y:0},{x:a.year.toString()+"-02-29",y:0},{x:a.year.toString()+"-03-01",y:0},{x:a.year.toString()+"-03-02",y:0},{x:a.year.toString()+"-03-03",y:0},{x:a.year.toString()+"-03-04",y:0},{x:a.year.toString()+"-03-05",y:0},{x:a.year.toString()+"-03-06",y:0},{x:a.year.toString()+"-03-07",y:0},{x:a.year.toString()+"-03-08",y:0},{x:a.year.toString()+"-03-09",y:0},{x:a.year.toString()+"-03-10",y:0},{x:a.year.toString()+"-03-11",y:0},{x:a.year.toString()+"-03-12",y:0},{x:a.year.toString()+"-03-13",y:0},{x:a.year.toString()+"-03-14",y:0},{x:a.year.toString()+"-03-15",y:0},{x:a.year.toString()+"-03-16",y:0},{x:a.year.toString()+"-03-17",y:0},{x:a.year.toString()+"-03-18",y:0},{x:a.year.toString()+"-03-19",y:0},{x:a.year.toString()+"-03-20",y:0},{x:a.year.toString()+"-03-21",y:0},{x:a.year.toString()+"-03-22",y:0},{x:a.year.toString()+"-03-23",y:0},{x:a.year.toString()+"-03-24",y:0},{x:a.year.toString()+"-03-25",y:0},{x:a.year.toString()+"-03-26",y:0},{x:a.year.toString()+"-03-27",y:0},{x:a.year.toString()+"-03-28",y:0},{x:a.year.toString()+"-03-29",y:0},{x:a.year.toString()+"-03-30",y:0},{x:a.year.toString()+"-03-31",y:0},{x:a.year.toString()+"-04-01",y:0},{x:a.year.toString()+"-04-02",y:0},{x:a.year.toString()+"-04-03",y:0},{x:a.year.toString()+"-04-04",y:0},{x:a.year.toString()+"-04-05",y:0},{x:a.year.toString()+"-04-06",y:0},{x:a.year.toString()+"-04-07",y:0},{x:a.year.toString()+"-04-08",y:0},{x:a.year.toString()+"-04-09",y:0},{x:a.year.toString()+"-04-10",y:0},{x:a.year.toString()+"-04-11",y:0},{x:a.year.toString()+"-04-12",y:0},{x:a.year.toString()+"-04-13",y:0},{x:a.year.toString()+"-04-14",y:0},{x:a.year.toString()+"-04-15",y:0},{x:a.year.toString()+"-04-16",y:0},{x:a.year.toString()+"-04-17",y:0},{x:a.year.toString()+"-04-18",y:0},{x:a.year.toString()+"-04-19",y:0},{x:a.year.toString()+"-04-20",y:0},{x:a.year.toString()+"-04-21",y:0},{x:a.year.toString()+"-04-22",y:0},{x:a.year.toString()+"-04-22",y:0},{x:a.year.toString()+"-04-23",y:0},{x:a.year.toString()+"-04-23",y:0},{x:a.year.toString()+"-04-24",y:0},{x:a.year.toString()+"-04-24",y:0},{x:a.year.toString()+"-04-25",y:0},{x:a.year.toString()+"-04-25",y:0},{x:a.year.toString()+"-04-26",y:0},{x:a.year.toString()+"-04-26",y:0},{x:a.year.toString()+"-04-27",y:0},{x:a.year.toString()+"-04-27",y:0},{x:a.year.toString()+"-04-28",y:0},{x:a.year.toString()+"-04-29",y:0},{x:a.year.toString()+"-04-29",y:0},{x:a.year.toString()+"-04-30",y:0},{x:a.year.toString()+"-04-30",y:0},{x:a.year.toString()+"-05-01",y:0},{x:a.year.toString()+"-05-01",y:0},{x:a.year.toString()+"-05-02",y:0},{x:a.year.toString()+"-05-02",y:0},{x:a.year.toString()+"-05-03",y:0},{x:a.year.toString()+"-05-03",y:0},{x:a.year.toString()+"-05-04",y:0},{x:a.year.toString()+"-05-04",y:0},{x:a.year.toString()+"-05-05",y:0},{x:a.year.toString()+"-05-06",y:0},{x:a.year.toString()+"-05-07",y:0},{x:a.year.toString()+"-05-07",y:0},{x:a.year.toString()+"-05-08",y:0},{x:a.year.toString()+"-05-08",y:0},{x:a.year.toString()+"-05-09",y:0},{x:a.year.toString()+"-05-09",y:0},{x:a.year.toString()+"-05-10",y:0},{x:a.year.toString()+"-05-10",y:0},{x:a.year.toString()+"-05-11",y:0},{x:a.year.toString()+"-05-11",y:0},{x:a.year.toString()+"-05-12",y:0},{x:a.year.toString()+"-05-13",y:0},{x:a.year.toString()+"-05-14",y:0},{x:a.year.toString()+"-05-14",y:0},{x:a.year.toString()+"-05-15",y:0},{x:a.year.toString()+"-05-15",y:0},{x:a.year.toString()+"-05-16",y:0},{x:a.year.toString()+"-05-16",y:0},{x:a.year.toString()+"-05-17",y:0},{x:a.year.toString()+"-05-17",y:0},{x:a.year.toString()+"-05-18",y:0},{x:a.year.toString()+"-05-19",y:0},{x:a.year.toString()+"-05-20",y:0},{x:a.year.toString()+"-05-21",y:0},{x:a.year.toString()+"-05-21",y:0},{x:a.year.toString()+"-05-22",y:0},{x:a.year.toString()+"-05-22",y:0},{x:a.year.toString()+"-05-23",y:0},{x:a.year.toString()+"-05-23",y:0},{x:a.year.toString()+"-05-24",y:0},{x:a.year.toString()+"-05-24",y:0},{x:a.year.toString()+"-05-25",y:0},{x:a.year.toString()+"-05-25",y:0},{x:a.year.toString()+"-05-26",y:0},{x:a.year.toString()+"-05-27",y:0},{x:a.year.toString()+"-05-28",y:0},{x:a.year.toString()+"-05-29",y:0},{x:a.year.toString()+"-05-29",y:0},{x:a.year.toString()+"-05-30",y:0},{x:a.year.toString()+"-05-30",y:0},{x:a.year.toString()+"-05-31",y:0},{x:a.year.toString()+"-05-31",y:0},{x:a.year.toString()+"-06-01",y:0},{x:a.year.toString()+"-06-01",y:0},{x:a.year.toString()+"-06-02",y:0},{x:a.year.toString()+"-06-02",y:0},{x:a.year.toString()+"-06-03",y:0},{x:a.year.toString()+"-06-03",y:0},{x:a.year.toString()+"-06-04",y:0},{x:a.year.toString()+"-06-04",y:0},{x:a.year.toString()+"-06-05",y:0},{x:a.year.toString()+"-06-05",y:0},{x:a.year.toString()+"-06-06",y:0},{x:a.year.toString()+"-06-06",y:0},{x:a.year.toString()+"-06-07",y:0},{x:a.year.toString()+"-06-07",y:0},{x:a.year.toString()+"-06-08",y:0},{x:a.year.toString()+"-06-08",y:0},{x:a.year.toString()+"-06-09",y:0},{x:a.year.toString()+"-06-09",y:0},{x:a.year.toString()+"-06-10",y:0},{x:a.year.toString()+"-06-11",y:0},{x:a.year.toString()+"-06-11",y:0},{x:a.year.toString()+"-06-12",y:0},{x:a.year.toString()+"-06-12",y:0},{x:a.year.toString()+"-06-13",y:0},{x:a.year.toString()+"-06-13",y:0},{x:a.year.toString()+"-06-14",y:0},{x:a.year.toString()+"-06-14",y:0},{x:a.year.toString()+"-06-15",y:0},{x:a.year.toString()+"-06-16",y:0},{x:a.year.toString()+"-06-17",y:0},{x:a.year.toString()+"-06-18",y:0},{x:a.year.toString()+"-06-19",y:0},{x:a.year.toString()+"-06-20",y:0},{x:a.year.toString()+"-06-21",y:0},{x:a.year.toString()+"-06-22",y:0},{x:a.year.toString()+"-06-23",y:0},{x:a.year.toString()+"-06-24",y:0},{x:a.year.toString()+"-06-25",y:0},{x:a.year.toString()+"-06-25",y:0},{x:a.year.toString()+"-06-26",y:0},{x:a.year.toString()+"-06-26",y:0},{x:a.year.toString()+"-06-27",y:0},{x:a.year.toString()+"-06-27",y:0},{x:a.year.toString()+"-06-28",y:0},{x:a.year.toString()+"-06-28",y:0},{x:a.year.toString()+"-06-29",y:0},{x:a.year.toString()+"-06-29",y:0},{x:a.year.toString()+"-06-30",y:0},{x:a.year.toString()+"-07-01",y:0},{x:a.year.toString()+"-07-02",y:0},{x:a.year.toString()+"-07-02",y:0},{x:a.year.toString()+"-07-03",y:0},{x:a.year.toString()+"-07-03",y:0},{x:a.year.toString()+"-07-04",y:0},{x:a.year.toString()+"-07-04",y:0},{x:a.year.toString()+"-07-05",y:0},{x:a.year.toString()+"-07-06",y:0},{x:a.year.toString()+"-07-06",y:0},{x:a.year.toString()+"-07-07",y:0},{x:a.year.toString()+"-07-08",y:0},{x:a.year.toString()+"-07-09",y:0},{x:a.year.toString()+"-07-10",y:0},{x:a.year.toString()+"-07-10",y:0},{x:a.year.toString()+"-07-11",y:0},{x:a.year.toString()+"-07-12",y:0},{x:a.year.toString()+"-07-14",y:0},{x:a.year.toString()+"-07-15",y:0},{x:a.year.toString()+"-07-16",y:0},{x:a.year.toString()+"-07-17",y:0},{x:a.year.toString()+"-07-18",y:0},{x:a.year.toString()+"-07-19",y:0},{x:a.year.toString()+"-07-20",y:0},{x:a.year.toString()+"-07-21",y:0},{x:a.year.toString()+"-07-22",y:0},{x:a.year.toString()+"-07-23",y:0},{x:a.year.toString()+"-07-24",y:0},{x:a.year.toString()+"-07-24",y:0},{x:a.year.toString()+"-07-25",y:0},{x:a.year.toString()+"-07-26",y:0},{x:a.year.toString()+"-07-26",y:0},{x:a.year.toString()+"-07-27",y:0},{x:a.year.toString()+"-07-27",y:0},{x:a.year.toString()+"-07-28",y:0},{x:a.year.toString()+"-07-29",y:0},{x:a.year.toString()+"-07-30",y:0},{x:a.year.toString()+"-07-30",y:0},{x:a.year.toString()+"-07-31",y:0},{x:a.year.toString()+"-08-01",y:0},{x:a.year.toString()+"-08-02",y:0},{x:a.year.toString()+"-08-03",y:0},{x:a.year.toString()+"-08-04",y:0},{x:a.year.toString()+"-08-05",y:0},{x:a.year.toString()+"-08-06",y:0},{x:a.year.toString()+"-08-06",y:0},{x:a.year.toString()+"-08-07",y:0},{x:a.year.toString()+"-08-08",y:0},{x:a.year.toString()+"-08-08",y:0},{x:a.year.toString()+"-08-09",y:0},{x:a.year.toString()+"-08-10",y:0},{x:a.year.toString()+"-08-11",y:0},{x:a.year.toString()+"-08-11",y:0},{x:a.year.toString()+"-08-12",y:0},{x:a.year.toString()+"-08-12",y:0},{x:a.year.toString()+"-08-13",y:0},{x:a.year.toString()+"-08-13",y:0},{x:a.year.toString()+"-08-14",y:0},{x:a.year.toString()+"-08-14",y:0},{x:a.year.toString()+"-08-15",y:0},{x:a.year.toString()+"-08-15",y:0},{x:a.year.toString()+"-08-16",y:0},{x:a.year.toString()+"-08-16",y:0},{x:a.year.toString()+"-08-17",y:0},{x:a.year.toString()+"-08-18",y:0},{x:a.year.toString()+"-08-18",y:0},{x:a.year.toString()+"-08-19",y:0},{x:a.year.toString()+"-08-19",y:0},{x:a.year.toString()+"-08-20",y:0},{x:a.year.toString()+"-08-21",y:0},{x:a.year.toString()+"-08-21",y:0},{x:a.year.toString()+"-08-22",y:0},{x:a.year.toString()+"-08-23",y:0},{x:a.year.toString()+"-08-23",y:0},{x:a.year.toString()+"-08-24",y:0},{x:a.year.toString()+"-08-25",y:0},{x:a.year.toString()+"-08-26",y:0},{x:a.year.toString()+"-08-27",y:0},{x:a.year.toString()+"-08-28",y:0},{x:a.year.toString()+"-08-28",y:0},{x:a.year.toString()+"-08-29",y:0},{x:a.year.toString()+"-08-29",y:0},{x:a.year.toString()+"-08-30",y:0},{x:a.year.toString()+"-08-31",y:0},{x:a.year.toString()+"-09-01",y:0},{x:a.year.toString()+"-09-02",y:0},{x:a.year.toString()+"-09-03",y:0},{x:a.year.toString()+"-09-04",y:0},{x:a.year.toString()+"-09-04",y:0},{x:a.year.toString()+"-09-05",y:0},{x:a.year.toString()+"-09-05",y:0},{x:a.year.toString()+"-09-06",y:0},{x:a.year.toString()+"-09-06",y:0},{x:a.year.toString()+"-09-07",y:0},{x:a.year.toString()+"-09-07",y:0},{x:a.year.toString()+"-09-08",y:0},{x:a.year.toString()+"-09-08",y:0},{x:a.year.toString()+"-09-09",y:0},{x:a.year.toString()+"-09-09",y:0},{x:a.year.toString()+"-09-10",y:0},{x:a.year.toString()+"-09-11",y:0},{x:a.year.toString()+"-09-12",y:0},{x:a.year.toString()+"-09-13",y:0},{x:a.year.toString()+"-09-14",y:0},{x:a.year.toString()+"-09-15",y:0},{x:a.year.toString()+"-09-15",y:0},{x:a.year.toString()+"-09-16",y:0},{x:a.year.toString()+"-09-17",y:0},{x:a.year.toString()+"-09-18",y:0},{x:a.year.toString()+"-09-19",y:0},{x:a.year.toString()+"-09-19",y:0},{x:a.year.toString()+"-09-20",y:0},{x:a.year.toString()+"-09-21",y:0},{x:a.year.toString()+"-09-21",y:0},{x:a.year.toString()+"-09-22",y:0},{x:a.year.toString()+"-09-23",y:0},{x:a.year.toString()+"-09-23",y:0},{x:a.year.toString()+"-09-24",y:0},{x:a.year.toString()+"-09-24",y:0},{x:a.year.toString()+"-09-25",y:0},{x:a.year.toString()+"-09-26",y:0},{x:a.year.toString()+"-09-26",y:0},{x:a.year.toString()+"-09-27",y:0},{x:a.year.toString()+"-09-27",y:0},{x:a.year.toString()+"-09-28",y:0},{x:a.year.toString()+"-09-28",y:0},{x:a.year.toString()+"-09-29",y:0},{x:a.year.toString()+"-09-29",y:0},{x:a.year.toString()+"-09-30",y:0},{x:a.year.toString()+"-09-30",y:0},{x:a.year.toString()+"-10-01",y:0},{x:a.year.toString()+"-10-01",y:0},{x:a.year.toString()+"-10-02",y:0},{x:a.year.toString()+"-10-02",y:0},{x:a.year.toString()+"-10-03",y:0},{x:a.year.toString()+"-10-03",y:0},{x:a.year.toString()+"-10-04",y:0},{x:a.year.toString()+"-10-04",y:0},{x:a.year.toString()+"-10-05",y:0},{x:a.year.toString()+"-10-05",y:0},{x:a.year.toString()+"-10-06",y:0},{x:a.year.toString()+"-10-07",y:0},{x:a.year.toString()+"-10-08",y:0},{x:a.year.toString()+"-10-08",y:0},{x:a.year.toString()+"-10-09",y:0},{x:a.year.toString()+"-10-10",y:0},{x:a.year.toString()+"-10-11",y:0},{x:a.year.toString()+"-10-11",y:0},{x:a.year.toString()+"-10-12",y:0},{x:a.year.toString()+"-10-12",y:0},{x:a.year.toString()+"-10-13",y:0},{x:a.year.toString()+"-10-13",y:0},{x:a.year.toString()+"-10-14",y:0},{x:a.year.toString()+"-10-14",y:0},{x:a.year.toString()+"-10-15",y:0},{x:a.year.toString()+"-10-15",y:0},{x:a.year.toString()+"-10-16",y:0},{x:a.year.toString()+"-10-16",y:0},{x:a.year.toString()+"-10-17",y:0},{x:a.year.toString()+"-10-18",y:0},{x:a.year.toString()+"-10-18",y:0},{x:a.year.toString()+"-10-19",y:0},{x:a.year.toString()+"-10-19",y:0},{x:a.year.toString()+"-10-20",y:0},{x:a.year.toString()+"-10-20",y:0},{x:a.year.toString()+"-10-21",y:0},{x:a.year.toString()+"-10-21",y:0},{x:a.year.toString()+"-10-22",y:0},{x:a.year.toString()+"-10-23",y:0},{x:a.year.toString()+"-10-24",y:0},{x:a.year.toString()+"-10-24",y:0},{x:a.year.toString()+"-10-25",y:0},{x:a.year.toString()+"-10-25",y:0},{x:a.year.toString()+"-10-26",y:0},{x:a.year.toString()+"-10-27",y:0},{x:a.year.toString()+"-10-28",y:0},{x:a.year.toString()+"-10-29",y:0},{x:a.year.toString()+"-10-29",y:0},{x:a.year.toString()+"-10-30",y:0},{x:a.year.toString()+"-10-30",y:0},{x:a.year.toString()+"-10-31",y:0},{x:a.year.toString()+"-10-31",y:0},{x:a.year.toString()+"-11-01",y:0},{x:a.year.toString()+"-11-01",y:0},{x:a.year.toString()+"-11-02",y:0},{x:a.year.toString()+"-11-03",y:0},{x:a.year.toString()+"-11-03",y:0},{x:a.year.toString()+"-11-04",y:0},{x:a.year.toString()+"-11-05",y:0},{x:a.year.toString()+"-11-06",y:0},{x:a.year.toString()+"-11-07",y:0},{x:a.year.toString()+"-11-08",y:0},{x:a.year.toString()+"-11-08",y:0},{x:a.year.toString()+"-11-09",y:0},{x:a.year.toString()+"-11-10",y:0},{x:a.year.toString()+"-11-11",y:0},{x:a.year.toString()+"-11-12",y:0},{x:a.year.toString()+"-11-13",y:0},{x:a.year.toString()+"-11-13",y:0},{x:a.year.toString()+"-11-14",y:0},{x:a.year.toString()+"-11-14",y:0},{x:a.year.toString()+"-11-15",y:0},{x:a.year.toString()+"-11-16",y:0},{x:a.year.toString()+"-11-17",y:0},{x:a.year.toString()+"-11-18",y:0},{x:a.year.toString()+"-11-19",y:0},{x:a.year.toString()+"-11-20",y:0},{x:a.year.toString()+"-11-21",y:0},{x:a.year.toString()+"-11-22",y:0},{x:a.year.toString()+"-11-23",y:0},{x:a.year.toString()+"-11-24",y:0},{x:a.year.toString()+"-11-24",y:0},{x:a.year.toString()+"-11-25",y:0},{x:a.year.toString()+"-11-26",y:0},{x:a.year.toString()+"-11-26",y:0},{x:a.year.toString()+"-11-27",y:0},{x:a.year.toString()+"-11-28",y:0},{x:a.year.toString()+"-11-28",y:0},{x:a.year.toString()+"-11-29",y:0},{x:a.year.toString()+"-11-29",y:0},{x:a.year.toString()+"-11-30",y:0},{x:a.year.toString()+"-12-01",y:0},{x:a.year.toString()+"-12-01",y:0},{x:a.year.toString()+"-12-02",y:0},{x:a.year.toString()+"-12-03",y:0},{x:a.year.toString()+"-12-04",y:0},{x:a.year.toString()+"-12-04",y:0},{x:a.year.toString()+"-12-05",y:0},{x:a.year.toString()+"-12-05",y:0},{x:a.year.toString()+"-12-06",y:0},{x:a.year.toString()+"-12-07",y:0},{x:a.year.toString()+"-12-08",y:0},{x:a.year.toString()+"-12-08",y:0},{x:a.year.toString()+"-12-09",y:0},{x:a.year.toString()+"-12-09",y:0},{x:a.year.toString()+"-12-10",y:0},{x:a.year.toString()+"-12-10",y:0},{x:a.year.toString()+"-12-11",y:0},{x:a.year.toString()+"-12-11",y:0},{x:a.year.toString()+"-12-12",y:0},{x:a.year.toString()+"-12-12",y:0},{x:a.year.toString()+"-12-13",y:0},{x:a.year.toString()+"-12-14",y:0},{x:a.year.toString()+"-12-15",y:0},{x:a.year.toString()+"-12-16",y:0},{x:a.year.toString()+"-12-17",y:0},{x:a.year.toString()+"-12-17",y:0},{x:a.year.toString()+"-12-18",y:0},{x:a.year.toString()+"-12-18",y:0},{x:a.year.toString()+"-12-19",y:0},{x:a.year.toString()+"-12-19",y:0},{x:a.year.toString()+"-12-20",y:0},{x:a.year.toString()+"-12-20",y:0},{x:a.year.toString()+"-12-21",y:0},{x:a.year.toString()+"-12-21",y:0},{x:a.year.toString()+"-12-22",y:0},{x:a.year.toString()+"-12-22",y:0},{x:a.year.toString()+"-12-23",y:0},{x:a.year.toString()+"-12-24",y:0},{x:a.year.toString()+"-12-25",y:0},{x:a.year.toString()+"-12-25",y:0},{x:a.year.toString()+"-12-26",y:0},{x:a.year.toString()+"-12-27",y:0},{x:a.year.toString()+"-12-28",y:0},{x:a.year.toString()+"-12-29",y:0},{x:a.year.toString()+"-12-30",y:0},{x:a.year.toString()+"-12-30",y:0}]},g=_.pluck(f.data,"x");g.unshift("time");var h=_.pluck(f.data,"y");h.unshift("zero");var i={"01":"Alabama","02":"Alaska","04":"Arizona","05":"Arkansas","06":"California","08":"Colorado","09":"Connecticut",10:"Delaware",12:"Florida",11:"DC",13:"Georgia",15:"Hawaii",16:"Idaho",17:"Illinois",18:"Indiana",19:"Iowa",20:"Kansas",21:"Kentucky",22:"Louisiana",23:"Maine",24:"Maryland",25:"Massachusetts",26:"Michigan",27:"Minnesota",28:"Mississippi",29:"Missouri",30:"Montana",31:"Nebraska",32:"Nevada",33:"New Hampshire",34:"New Jersey",35:"New Mexico",36:"New York",37:"North Carolina",38:"North Dakota",39:"Ohio",40:"Oklahoma",41:"Oregon",42:"Pennsylvania",44:"Rhode Island",45:"South Carolina",46:"South Dakota",47:"Tennessee",48:"Texas",49:"Utah",50:"Vermont",51:"Virginia",53:"Washington",54:"West Virginia",55:"Wisconsin",56:"Wyoming",72:"Puerto Rico",78:"Virgin Islands"};a.appendSeries=function(b,c){d.get({year:c,id:b},function(d){console.log("droughtioApp.controller:MainCtrl:$scope.appendSeries:data",d),a.year=c,d.unshift(i[b]),m.load({columns:[d]}),m.unload("zero"),d3.select("#fips"+b.toString()).style("stroke",m.color(i[b])).on("mouseover",function(){a.focused=i[b],m.focus(i[b])}).on("mouseout",function(){m.revert()}).on("click",function(){m.toggle(i[b]),d3.select(this).attr("class","administrative")})})},a.mapTitles=["Drought Severity","Land Requiring Irrigation (% Total)"],a.index={},a.mapTitle=a.mapTitles[0],a.chartTitle="Cumulative Rainfall (inches)",a.toggleMap=function(){console.log("toggleMap",a.mapTitle,a.mapTitles[0]),a.mapTitle===a.mapTitles[1]?(a.mapTitle=a.mapTitles[0],d3.select("#irrigation").attr("visibility","hidden"),d3.select("#zones").attr("visibility","visible")):a.mapTitle===a.mapTitles[0]&&(a.mapTitle=a.mapTitles[1],d3.select("#zones").attr("visibility","hidden"),d3.select("#irrigation").attr("visibility","visible"))};var j=(Math.min($("#chart").innerWidth(),700),Math.max(window.innerHeight-30-$("#navbar").outerHeight(),240)),k=320,l=Math.max((j-k)/2,0);$("#chart").parent().find("h2").css("margin-top",l),a.schema={x:{type:"datetime",format:"%Y-%m-%d",name:"Date"}},a.config={bindto:"#chart",size:{height:k},data:{x:"time",columns:[g,h],type:"step"},axis:{x:{type:"timeseries",tick:{count:12,culling:!1,fit:!0,format:"%b"}},y:{tick:{format:d3.format(",")}}},tooltip:{format:{title:d3.time.format("%B %e, %Y"),value:d3.format(",")}},grid:{y:{show:!0}},legend:{show:!1}};var m=c3.generate(a.config);$("#navbar").css("margin-top",window.innerHeight-document.getElementById("navbar").getBoundingClientRect().bottom-20);var n=function(){var b=e(c.nextSelection(),2).toString();console.log("select "+b),m.data().hasOwnProperty(i[b])?(console.log("show "+b),m.show(i[b])):a.appendSeries(b,a.year)};c.registerObserverCallback("select",n)}]);